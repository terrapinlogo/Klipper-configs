[gcode_macro LOAD_FILAMENT]
gcode:
  {% set speed = params.SPEED|default(300) %}

  {% if printer.extruder.target < printer.configfile.settings.extruder.min_extrude_temp %}
    STATUS_HEATING
    M109 S220
  {% endif %}

  M221 S100 # flow 100%. prevent extrude too long
  M220 S100 # speed 100%

  STATUS_BUSY
  G91
  G92 E0
  G1 E50 F900
  G1 E50 F{speed} #purge
  STATUS_READY
  
[gcode_macro UNLOAD_FILAMENT]
gcode:
  {% set speed = params.SPEED|default(1200) %}

  {% if printer.extruder.target < printer.configfile.settings.extruder.min_extrude_temp %}
    STATUS_HEATING
    M109 S220
  {% endif %}

  M221 S100 # flow 100%. prevent extrude too long
  M220 S100 # speed 100%

  STATUS_BUSY
  G91
  G1 E-50 F{speed}
  G1 E-50 #100mm
  G92
  STATUS_READY
